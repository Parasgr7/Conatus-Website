var IcoRoll=function(a,b){var c=this;this._menu=!!b&&b,this._tip_free=!0,this._attrs={},this._back=!1,this._ctime,this._is_scrolling=!1,this._should_hide_back=!1,this._menu_showed=!1,this._can_add_hide_button=!0,this._first_time=!0,this._istouching=!1,this._current_outside=!1,this._menuHidedComplete=!1,this._$root,this._above_size=0,this._under_size=0,this._default_attrs={links:$(".icoroll"),time:2e3,tip_distance:30,tip_text:"Click to see more",back_enabled:!0,back_text:"Back",mobile_width:600,showOnMobile:!0,menu_show_time:500,onmenuClick:function(a,b){},onmenuCurrent:function(a,b){}};for(attr in this._default_attrs)this._attrs[attr]=this._default_attrs[attr];for(attr in a)this._attrs[attr]=a[attr];var d=this._attrs.links;this._time=this._attrs.time,this._init=function(){this._window_height=$(window).height(),d.css("cursor","pointer"),$("body").append('<div id="scroll_tip" class="scroll_colors"></div>'),$("body").append('<div id="scroll_back" ><span class="scroll_colors">'+this._attrs.back_text+"</span></div>"),this._$=$("#scroll_tip"),this._$back=$("#scroll_back"),this._hideBack();var a=this._attrs.menu_show_time/1e3;a="top "+a+"s",this._$back.css({transition:a,"-moz-transition":a,"-webkit-transition":a,"-o-transition":a}),this._attrs.back_enabled||this._$back.css({display:"none"}),this._menu&&(this._generateMenu(),this._generateBlocks()),this._bind(),$(window).trigger("scroll"),$(window).trigger("resize"),$(window).on("load",function(){c._generateBlocks(),$(window).trigger("scroll")}),this._menu&&(this._generateBlocks(),this._setMenuTransition())},this._generateMenu=function(){var a='<div id="scroll_menu"><div id="scroll_show_menu_button" class="icon-menu-2 scroll_colors hide_button"></div>';a+='<div id="scroll_up_button" class="hover_colors icon-arrow-up nav" ></div>',a+='<ul class="scroll_menu scroll_colors">';for(el in this._menu.elements)a+='<li id="menu_scroll_number_'+el+'" data-number="'+el+'">',this._menu.position&&"right"==this._menu.position?(a+='<a href="'+this._menu.elements[el].href+'" class="scroll_colors '+this._menu.elements[el].class+'"></a>',this._menu.elements[el].content&&(a+='<span class="scroll_colors">'+this._menu.elements[el].content+"</span>")):(this._menu.elements[el].content&&(a+='<span class="scroll_colors">'+this._menu.elements[el].content+"</span>"),a+='<a href="'+this._menu.elements[el].href+'" class="scroll_colors '+this._menu.elements[el].class+'"></a>'),a+="</li>";a+="</ul>",a+='<div id="scroll_down_button" class="hover_colors icon-arrow-down nav" ></div></div>',$("body").append(a),this._$menu=$(".scroll_menu"),this._menu.position&&"right"==this._menu.position?$(".scroll_menu li span").css({left:this._$menu.width()}):$(".scroll_menu li span").css({right:this._$menu.width()}),this._menu.position&&"right"==this._menu.position?this._$menu.addClass("scroll_right_menu"):this._$menu.addClass("scroll_left_menu"),this._$button=$("#scroll_show_menu_button"),this._$nav_up=$("#scroll_up_button"),this._$nav_down=$("#scroll_down_button"),this._$navs=$("#scroll_menu .nav"),this._$root=$("#scroll_menu"),this._setMenuPosition(),this._setMenuButtons(),this._countHeights(),this._setMenuPosition()},this._setMenuTransition=function(){var a=this._attrs.menu_show_time/1e3,b="opacity "+a+"s, right "+a+"s, left "+a+"s",c="top 0.4s,"+b;this._$menu.css({transition:c,"-moz-transition":c,"-webkit-transition":c,"-o-transition":c}),this._$navs.css({transition:b,"-moz-transition":b,"-webkit-transition":b,"-o-transition":b})},this._setMenuButtons=function(){this._menu.position&&"right"==this._menu.position?(this._$button.addClass("right"),this._$navs.addClass("right")):(this._$button.addClass("left"),this._$navs.addClass("left"))},this._setMenuPosition=function(){this._$menu.css("top",this._above_size),this._$menu.css("display","block"),this._mousestep=this._$menu.find("li").height(),this._menu_height=this._$menu.height()},this._countHeights=function(){this._menu_height<c._window_height-this._above_size-this._under_size?this._above_size=(c._window_height-this._menu_height)/2:this._above_size+=this._$nav_up.height(),this._under_size=this._$nav_down.height(),this._menu_visible_elements=Math.round((c._window_height-this._above_size-this._under_size)/this._$menu.find("li").height()),this._menu_center_element=Math.ceil(this._menu_visible_elements/2)},this._generateBlocks=function(){this._blocks=[];c.__checkBrowser();for(i in this._menu.elements){var b=this._menu.elements[i].href;b.match(/^http/)||$(this._menu.elements[i].href).length>0&&(this._blocks[$(b).offset().top]=b)}},this._linkScrollEvent=function(a){this._back=a.offset().top-c._window_height/2;var b=a.attr("data-href"),d=a.attr("data-back")?a.attr("data-back"):"";this._$back.find("span").html(this._attrs.back_text+" "+d),b||(b=a.attr("href")),this._scroll(a,$(b)),null==a.attr("data-noback")&&this._showBack()},this._scroll=function(a,b,c){var d=this;this._is_scrolling=!0,this._should_hide_back=!1;var e="number"==typeof a?a:a.offset().top,f="number"==typeof b?b:b.offset().top,g=$("body").height(),h=Math.abs(e-f)/g*this._time;$("html,body").animate({scrollTop:f-this._$back.height()},h,function(){d._is_scrolling=!1,c&&c()}),this._ctime=h},this._bind=function(){this._bindLinks(),this._bindScroll(),this._bindBack(),this._menu&&(this._bindMenu(),this._bindNavs(),this._bindBrowserLocation(),this._bindBrowserBack()),this._bindResize(),this._bindShowButton()},this._bindLinks=function(){var a=this;d.bind("click",function(b){return a._linkScrollEvent($(this)),b.preventDefault(),!1}),d.hover(function(){var b=$(this).attr("data-title")?$(this).attr("data-title"):a._attrs.tip_text;if(a._$.html("<span>"+b+"</span>"),a._attrs.tip_distance)var c=a._attrs.tip_distance;else var c=$(this).height()>a._$.height()?$(this).height():a._$.height();var d=$(this).offset().top-c,e=$(this).offset().left+$(this).width()/2-a._$.width()/2;a._$.css({top:d,left:e}),a._$.addClass("scroll_tip_show")},function(){a._$.removeClass("scroll_tip_show")})},this._bindBack=function(){var a=this;this._$back.bind("click",function(b){return null!=a._ctime&&0!=a._ctime||(a._ctime=200),a._back&&($("html,body").animate({scrollTop:a._back},a._ctime),a._hideBack()),b.preventDefault(),!1})},this._bindResize=function(){var a=this;$(window).bind("resize",function(){a._menu&&(a._window_height=$(window).height(),a._generateBlocks(),a._above_size=0,a._under_size=0,$(window).width()<a._attrs.mobile_width?(a._first_time&&(a._hideMenu(),a._first_time=!1),a._showButton(),a._above_size=a._$button.height(),a._attrs.showOnMobile||a._hideMenuCompletely()):(a._attrs.showOnMobile||a._showMenuCompletely(),a._showMenu(),a._hideButton()),a._window_height-a._above_size<a._menu_height?(a._showUpDownButtons(),a._countHeights()):(a._above_size=(a._window_height-a._menu_height)/2,a._hideUpDownButtons()),a._setMenuPosition())})},this._bindBrowserBack=function(){$(window).on("popstate",function(a){return a.stopPropagation(),a.preventDefault(),!1})},this._bindBrowserLocation=function(){$(window).on("hashchange",function(a){var b=window.location.href.substr(window.location.href.indexOf("#")),d=c._$menu.find('a[href="'+b+'"]').first().parent();return d.trigger("click"),a.stopPropagation(),a.preventDefault(),!1})},this.__menuUp=function(a){var b=parseInt(c._$menu.css("top"));return b+c._mousestep>c._above_size?c._$menu.css("top",c._above_size):c._$menu.css("top",b+c._mousestep),a.preventDefault(),!1},this.__menuDown=function(a){var b=parseInt(c._$menu.css("top")),d=c._window_height-c._under_size;return b+c._menu_height-c._mousestep<d?c._$menu.css("top",d-c._menu_height):c._$menu.css("top",b-c._mousestep),a.preventDefault(),!1},this._bindNavs=function(){this._$nav_up.click(this.__menuUp),this._$nav_down.click(this.__menuDown)},this._bindShowButton=function(){var a=this;$(document).on("click",".hide_button",function(){a.__buttonShowHideMenuEvent()})},this.__buttonShowHideMenuEvent=function(){this._menu_showed?(this._hideMenu(),this._menu_showed=!1):(this._showMenu(),this._menu_showed=!0)},this._bindMenu=function(){var a=this,b=function(b){if(!b)var b=this;if(a._istouching)return!1;a._hideBack();var c=a._current.offset().top;c<a._$nav_up.offset().top||c>a._$nav_down.offset().top?a._current_outside=!0:a._current_outside=!1;var d=$(b).find("a").attr("href"),e=$(b);null!=a._menu.elements[e.attr("data-number")].onClick?a._menu.elements[e.attr("data-number")].onClick(e,parseInt(e.attr("data-number"))):a._attrs.onmenuClick(e,parseInt(e.attr("data-number")));var f=a.__checkBrowser();if(d.match(/^http/)){if(!("msie"==f.browser&&parseInt(f.version)<8))return window.open(d);var g=d.match(/#([a-z0-9_]+)/);if(!g)return window.open(d);d=g[0]}return 0!=$(d).length?(a._scroll($(window).scrollTop(),$(d),function(){a._current_outside=!1,a._saveToHistory(e)}),!1):void 0},c=function(){var b=$(this),d=($(this).find("a"),$(this).find("span"));b.siblings().css("left",0);var e=a.__checkBrowser();return!("msie"==e.browser&&parseInt(e.version)<8)&&void(a._menu.position&&"right"==a._menu.position?b.css("left",-(parseInt(d.width())+parseInt(d.css("padding-right")))):b.css("left",parseInt(d.width())+parseInt(d.css("padding-left"))))},d=function(){$(this).css("left",0)};this.menuHover=c,this.menuUnhover=d,this._$menu.find("li").hover(function(a){c.call(this)},function(a){d.call(this)}),this._$menu.find("a").click(function(a){return a.preventDefault(),b($(this).parent().get()),!1}),this._$menu.find("li").click(function(a){b(this)});var e=this._$menu.find("li").get();if(e[0].addEventListener)for(el in e)e[el].addEventListener("touchstart",function(b){b.stopPropagation(),b.preventDefault(),a._mousey=b.touches[0].screenY,a._mousestep=a._$menu.find("a").height(),a._touchtime=(new Date).getTime(),a._istouching=!0},!1),e[el].addEventListener("touchend",function(e){a._istouching=!1;var f=(new Date).getTime();Math.abs(f-a._touchtime)<200?(null!=a._current&&d.call(a._current),b(this),!$(this).hasClass("current")||$(this).hasClass("hided")?(c.call($(this)),$(this).removeClass("hided")):$(this).addClass("hided")):d.call(a._current)},!1),e[el].addEventListener("touchmove",function(b){b.stopPropagation(),b.preventDefault();var c=a._mousey-b.touches[0].screenY;c=-c,Math.abs(c)<a._mousestep&&(c=c>0?a._mousestep:-a._mousestep),c=2*c,nvalue=parseInt(a._$menu.css("top"))+c;var e=nvalue+parseInt(a._menu_height),f=nvalue-a._above_size;return e<=a._window_height?a._$menu.css("top",a._window_height-a._menu_height-a._under_size):f>=0?a._$menu.css("top",a._above_size):(a._$menu.css("top",nvalue),a._mousey=b.touches[0].screenY,void d(a._current))},!1)},this._bindScroll=function(){var a=this;$(window).on("scroll",function(){var b=$(window).scrollTop(),c=$(window).height(),d=99999999,e=null,f=null;for(i in a._blocks)Math.abs(b-i)<d&&(d=Math.abs(b-i),f=a._blocks[i],i<b+c&&i>=b&&(e=a._blocks[i]));if(null==e&&(e=f),a._menu){var g=a._$menu.find('a[href="'+e+'"]');0==g.length&&(g=a._$menu.find('a[href*="'+e+'"]')),a._checkMenu(g.parent())}if(!a._is_scrolling){if(!a._should_hide_back)return a._should_hide_back=!0;a._should_hide_back=!1,a._hideBack()}}),a._menu&&this._$menu.on("mousewheel",function(b){return!(a._menu_height<a._window_height-a._above_size-a._under_size)&&void(b.originalEvent.wheelDelta/120>0?a.__menuUp(b):a.__menuDown(b))})},this._saveToHistory=function(a){window.history.state&&window.history.state.url==a.find("a").attr("href")||window.history.pushState&&window.history.pushState({url:a.find("a").attr("href")},a.find("a").attr("href"),a.find("a").attr("href"))},this._unbindScroll=function(){$(window).unbind("scroll")},this._hideMenuCompletely=function(){this._menuHidedComplete=!0,this._$root.css("display","none")},this._showMenuCompletely=function(){this._menuHidedComplete=!1,this._$root.css("display","block")},this._hideMenu=function(){this._menu.position&&"right"==this._menu.position?(this._$navs.css("right",-this._$menu.width()),this._$menu.css("right",-this._$menu.width())):(this._$navs.css("left",-this._$menu.width()),this._$menu.css("left",-this._$menu.width())),this._current.css("left",0),this._changeToShowButton()},this._showMenu=function(){this._menu.position&&"right"==this._menu.position?(this._$navs.css("right",0),this._$menu.css("right",0)):(this._$navs.css("left",0),this._$menu.css("left",0)),this._changeToHideButton()},this._showUpDownButtons=function(){this._$navs.css("display","block"),this._$nav_up.css({top:this._above_size,width:this._$menu.find("a").width()}),this._$nav_down.css({bottom:0,width:this._$menu.find("a").width()})},this._hideUpDownButtons=function(){this._$navs.css("display","none")},this._showButton=function(){this._$button.css("display","block")},this._hideButton=function(){this._$button.css("display","none")},this._hideBack=function(){this._$back.css("top",-this._$back.height())},this._showBack=function(){this._$back.css("top",0)},this._changeToHideButton=function(){this._$button.removeClass("icon-menu-2"),this._$button.addClass("icon-close")},this._changeToShowButton=function(){this._$button.removeClass("icon-close"),this._$button.addClass("icon-menu-2")},this._checkMenu=function(a){a.siblings().removeClass("current"),a.addClass("current"),null!=this._menu_timeout_id&&window.clearTimeout(this._menu_timeout_id),this._menu_timeout_id=window.setTimeout(function(){c._saveToHistory(a)},3e3);var b=!1;if(this._current&&this._current.attr("data-number")==a.attr("data-number")||(null!=c._menu.elements[a.attr("data-number")].onCurrent?c._menu.elements[a.attr("data-number")].onCurrent(a,parseInt(a.attr("data-number"))):c._attrs.onmenuCurrent(a,parseInt(a.attr("data-number")))),this._current=a,!(this._menu_height<c._window_height-c._above_size-c._under_size||this._current_outside)){var d=a.offset().top,e=this._$menu.offset().top,f=Math.round((d-e)/this._mousestep)+1;if(f<c._menu_center_element)var g=$("#menu_scroll_number_0");else var g=$("#menu_scroll_number_"+parseInt(f-c._menu_center_element+1));if(f>this._menu.elements.length-(c._menu_visible_elements-c._menu_center_element))var h=$("#menu_scroll_number_"+(this._menu.elements.length-1));else var h=$("#menu_scroll_number_"+parseInt(f+(c._menu_visible_elements-c._menu_center_element)-1));var i=$(window).scrollTop();if(0!=h.length){var j=g.offset().top-i,k=h.offset().top-i,l=c._window_height-this._under_size,m=this._above_size,n=this._$menu.offset().top-i;if(k>l){b=c._window_height-this._under_size-(k-n)-this._mousestep}else if(j<m){b=this._above_size-(j-n)}if(b!==!1){b=Math.round(b/this._mousestep)*this._mousestep;var p=b+parseInt(this._menu_height),n=b-this._above_size;return p<=c._window_height?c._$menu.css("top",c._window_height-c._menu_height-c._under_size):n>=0?this._$menu.css("top",this._above_size):void this._$menu.css("top",b)}}}},this.__checkBrowser=function(){return uaMatch=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},uaMatch(navigator.userAgent)},this._init()};icoroll=function(a,b){return new IcoRoll(a,b)};
